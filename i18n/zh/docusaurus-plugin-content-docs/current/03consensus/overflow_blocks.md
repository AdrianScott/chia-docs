---
sidebar_position: 9
---

# 3.9 溢出块和权重

## 溢出块

对于创建区块的农民来说，他们的所需迭代次数必须小于子时隙迭代次数 / 64，如[第 3.5 节](/docs/03consensus/signage_points_and_infusion_points "Section 3.5: Signage Points and Infusion Points")中所述。 这意味着融合迭代次数可能大于子时隙迭代次数，因此融合必须发生在下一个子时隙中。

**Overflow block**: a block whose infusion point is in a different sub-slot than its signage point.

**当前时隙挑战**：任何给定块的当前时隙挑战包括所有挑战从时隙中的第一个挑战开始，并在时隙的末尾结束（不包括在内）。 这是相关的，因为有时一个时隙跨越多个子时隙，因此存在多个挑战。

<figure>
<img src="/img/overflow.png" alt="drawing"/>
![](/img/overflow.png)

<figcaption>
图 9：该图中的 B4 是一个溢出块，因为注入位于下一个子时隙中。

B4 不是基于当前时隙挑战，因此不会减少赤字或制造挑战块。

</figcaption>
</figure>

Overflow blocks cannot exist in the first sub-slot of the epoch (since the sub-slot iterations change).

此外，溢出块不会改变赤字，除非它们基于当前时隙质询，因为溢出块是对前一个子时隙质询的响应。 溢出块不是挑战块，除非它们基于当前时隙挑战。 请注意，溢出块很少会减少赤字，因为赤字几乎总是减少到零，并且每个子时隙都会开始一个新的时隙。

## 最低区块要求

必须至少将 16 个当前时隙挑战块融合奖励链才能完成一个时隙。 （回想一下子时隙没有这样的要求，所以一个时隙可以跨越多个子时隙。）

赤字是一个介于 0 和 16 之间的数字，它出现在子时隙的开始处，并且存在于每个完成的块中。 这被定义为我们需要融合以完成一个时隙的奖励链块的数量。 每当我们启动一个时隙时，它都会重置为 16（因此每个挑战链注入必须至少有 16 个总块）。 每个基于当前时隙挑战的奖励链融入的赤字都会下降。

The block with deficit 15 is a challenge block.

正常情况是赤字从 16 开始，然后在子时隙内下降到零，并在我们完成时隙并开始新的时隙时重置回 16。 如果我们没有设法在子时隙末尾将其减少到 0，挑战链和融合挑战链（如果存在）继续，并且赤字不会重置为 16。 区块（包括溢出块）现在），继续从赤字中减去，直到我们达到 0。 当我们完成一个零赤字的子时隙时，融合挑战链被纳入挑战链，赤字重置为 16。

添加此要求是为了阻止远程攻击，并在[第 3.14 节](/docs/03consensus/attacks_and_countermeasures#51-46-attack "Section 3.14: Attacks and Countermeasures")中进行了详细描述。 绝大多数子时隙将有 16 个以上的块（回想一下，平均目标数为 32），因此最小块要求不会对正常操作产生太大影响。

<figure>
<img src="/img/deficit.png" alt="drawing"/>
![](/img/deficit.png)

<figcaption>
图 10：c2 是子时隙的末端，但不是时隙的末端。 c2 不指向 ic2，因为时隙没有在这个子时隙结束。
赤字是 3 而不是重置为 16，并且融入的挑战链继续。
</figcaption>
</figure>

## 权重

一个区块的**权重**是这个区块的难度加上所有作为这个区块祖先的先前区块的总和。 诚实的全节点必须选择区块链的峰值，使得峰值是他们知道的权重最大的块。 这是一个至关重要的要求，与比特币的最重链规则相同。 由于这条规则，拥有不到 50% 空间且没有 VDF 优势的攻击者将难以获得超过其公平份额的收益，因为他们必须幸运并创建比诚实链更多的奖励链块。 此外，农民只应对与最重链相对应的挑战。

VDF 速度和总空间量对权重都很重要，这些变化可以触发难度调整。 如果空间量增加，每个时隙将创建超过 32 个块，因此必须增加难度。 如果网络 VDF 速度增加，每 10 分钟创建超过 32 个块，因此必须增加难度（和子时隙迭代）。

但是，与拥有正常速度 VDF 的农民相比，拥有专属访问速度稍快 VDF 的农民无法轻松获得更多奖励。 如果攻击者试图孤立链上的一个块，拥有更快的 VDF 将无济于事，因为攻击者的链将拥有更少的块（因此权重较低）。 农民必须签署他们正在建造的区块，他们只会在最高权重的链上建造。

然而，当攻击者希望发起 51% 的攻击时，VDF 速度就会发挥作用。 在这种情况下，攻击者可以使用 VDF 创建一个完全替代的链，没有诚实的区块，并超越诚实的链。 这需要略少于 51% 的空间，因为更快的 VDF 链可以获得比诚实链更快的权重。 This attack is described in detail in [Section 3.14](/docs/03consensus/attacks_and_countermeasures "Section 3.14: Attacks and Countermeasures").
