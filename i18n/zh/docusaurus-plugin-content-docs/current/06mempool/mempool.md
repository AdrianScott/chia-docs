---
sidebar_position: 1
---

# 6.1 内存池

内存池（mempool 或 memory pool)）是由完整节点存储的交易集合，通常在内存中，然后在区块链上确认。 内存池不受共识规则的支配；农民可以在未经其他全节点许可的情况下更改其内存池的运作方式并自定义规则。

由于区块链的去中心化特性，内存池是奇亚的一个必需方面。 交易区块大约每 47 秒发生一次，并且无法预测谁将赢得区块。 因此，所有交易都必须广播到全网并存储在本地，直到它们被确认。 此外，挂起的交易数超过单个区块的容量是正常的，因此内存池也充当包含到区块链中的队列。

> 一个区块可以容纳多少笔交易？ 由于交易规模的不同，以及对“交易”的不同定义，没有一个确切的数字。 但仅作为粗略的指导，大约 1000 笔具有两个输入和两个输出的交易，或 2000 个具有一个输入和一个输出的交易可以放入一个块中。

当用户进行交易时，它会被发送到一个完整的节点，然后该节点对其进行验证，将其添加到内存池中，并将其广播给其所有对等方。 因此，交易会在很短的时间内传播到整个网络。

## 验证

只有有效的交易才能进入内存池。 验证交易的过程类似于验证区块的过程。 这包括运行 CLVM、检查条件、验证签名以及检查要花费的硬币当前是否未花费且有效。

The transaction is also checked against other transactions in the mempool, to ensure there are no conflicts.

## 加入所需的费用

如果内存池未满，则所有交易，无论费用如何，都将被接收到内存池中。 最大内存池大小会因版本而异，交易大小差异较大，但一般为 10-100 个区块。

从奇亚区块链版本 1.2.12 开始，内存池接受 0 费用的交易。 非常接近于零的费用被视为等价于零。 阈值设置为每个成本 5 mojo，但这可能因实现、版本和设置而异，因此协议不保证。

当内存池已满时，节点将开始拒绝不满足最低费用的交易。 全节点按费用对交易进行排序，并在包括新交易时首先剔除价值最低的交易。

## 替换为费用

A transaction can replace another tranasction in the mempool if it spends at least the same coins as the original one.

例如，如果原始交易花费了硬币 A 和 B，那么另一个花费 A、B 和 C 的交易可以替换它。 但是，花费 B 和 C 的交易不能。 这可以防止拒绝服务 (DOS) 攻击以及交易审查。 还有一个最低费用可能取决于所使用的内存池软件。 在 `奇亚区块链` 中，这被设置为 5 费用/成本。 这可以防止垃圾邮件替换交易。

## 区块创建

当农民创建一个区块时，他们将从内存池中选择最高费用/成本的交易，直到达到最大区块大小。 这些花费组合被组合成一个大的花费组合，它保证是有效的，因为内存池中的所有花费组合都必须花费不相交的硬币。

硬币支出不会影响其他硬币支出，这是 UTXO 系统的一个非常好的属性，并且允许验证和块创建的并行化。 总支出包也有一个总签名，它是该块中所有交易的所有签名的组合。

出于性能原因，奇亚区块链代码库目前仅创建较小的块（小于最大大小的 50%），以保持区块链更小且更易于运行。 在执行了额外的优化之后，这个“节流阀”很可能会在未来的版本中被删除。

## 更新内存池

将新区块添加到区块链后，所有完整节点都必须查看在该新区块中花费的硬币，并将它们从内存池中删除。 全节点不需要再次重新申请每笔交易，因为奇亚币的支出是确定性和沙盒的（有关更多信息，请参阅 [chialisp.com](https://chialisp.com)）。 全节点只需要查看新区块中花费的硬币，如果有任何交易花费了其中一个硬币，它们就会从内存池中删除。 这意味着内存池可以非常大，代码库可以很简单，并且可以实现高性能。
